<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='UTF-8'>
    <link href='chessStyle.css' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <script src='./pieces.js'></script>
    <script src='./isCheckIsMate.js'></script>
    <script>

      function validMove(piece){
        let tmpArr = [...pieces]
         
      }
      // event handlers
      let firstClick = true
      let fCId = ''
      let fCx, fCy
      function dragOnDrop(elem){
        if (firstClick){
          fCId = elem.target.id
          fCx = elem.target.x
          fCy = elem.target.y
        }
        else{
          console.log( 'second click')
          console.log( fCId,fCx, fCy, '::', elem.target.id, elem.target.x, elem.target.y)
        }
        firstClick = ! firstClick
        //elem.target.style.color='white'

      }


    </script>
    <script>
      let boardDiv = document.createElement('div')
      boardDiv.className = 'board'
      boardDiv.id = 'board'
      document.getElementsByTagName('body')[0].appendChild(boardDiv)

      // build empty board
      // div buffer
      let boardFrag = document.createDocumentFragment()
      for (let row=0; row<8; row++){
        let rowDiv = document.createElement('div')
        rowDiv.className='rowDiv'
        for (let col=0; col<8; col++){
          let tileDiv = document.createElement('div')
          tileDiv.className = 'tileDiv'
          tileDiv.style.backgroundColor = ((col+row)%2 === 1 ? 'brown' : 'tan')
          rowDiv.appendChild(tileDiv)
        }
        boardFrag.appendChild(rowDiv)
      }
      document.getElementById('board').appendChild(boardFrag)

      // helper function 
      function clearNode(node){
        while(node.firstChild){
          node.removeChild(node.firstChild)
        }
      }
      function fillBoard(color){
        let divs = document.getElementsByClassName('tileDiv')
        let alph =  ['a','b','c','d','e','f','g','h']
        alph = color ? alph.reverse() : alph
        for (let d=0; d<divs.length; d++){
          clearNode(divs[d])
          let dC = color ? d : Math.abs(d-63)
          let n = (Math.ceil((dC+1)/8)%8) || 8
          let a = alph[d%8]
          let id = a + n
          let coord = document.createTextNode(id)
          divs[d].id = id
          let piece = pieces.find(p => p.x===dC%8 && p.y===n-1) || null
          if (piece){
            piece.id = id
            let pChar = document.createElement('p')
                           .appendChild(document
                           .createTextNode(piece.char))
            divs[d].x = piece.x
            divs[d].y = piece.y
            divs[d].addEventListener('click', dragOnDrop, false)
            divs[d].appendChild(pChar)
          }
          else{
            divs[d].addEventListener('click', dragOnDrop, false)
            divs[d].appendChild(coord)
            divs[d].x = d%8 + 1
            divs[d].y = n + 1
          }
        }
      }
      fillBoard(0)

    let rvrBtn = document.createElement('button')
    rvrBtn.id = 'rvrBtn' 
    rvrBtn.side = 0
    rvrBtn.appendChild(document.createTextNode('flip'))
    document.getElementsByTagName('body')[0].appendChild(rvrBtn)
    rvrBtn.addEventListener('click', flipBoard, false)

    function flipBoard(event){
      rvrBtn.side = !rvrBtn.side
      return fillBoard(rvrBtn.side) 
    }

    
    </script>

  </body>
</html>
